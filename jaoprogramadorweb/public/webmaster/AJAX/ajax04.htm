<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>C&oacute;mo hacer una p&aacute;gina AJAX</title>
<META http-equiv=Content-Language content=es>
<META content="Programación,Programas,Aplicaciones,Ejercicios, Ejemplos,Tutoriales,Manuales" name=description>
<meta name="keywords" content="Primera página AJAX, Como hacer una pagina AJAX, Manual AJAX, tutorial AJAX, Ejemplos AJAX, ejercicios AJAX">
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<META content=euskalnet.net/jaoprogramador name=author>
<META content="Copyright (c) 2005 jaoprogramador" name=copyright>
<META scheme=RFC1766 content=español name=DC.Language>
<META content=es,sp,spanish,español name=lang>
<META content=all name=robots>
<link href="../../styles/estilos.css" rel="stylesheet" type="text/css">
</head>
<body>
<table class="tablaContenidos">
  <tr> 
    <td height="39" colspan="3"> <h2>Refactorizando la primera aplicación</h2></td>
  </tr>
  <tr> 
    <td height="394" colspan="3"> <h3>Refactorizando la primera aplicación</h3>
      <p>La primera aplicaci&oacute;n AJAX mostrada anteriormente presenta algunas 
        carencias importantes. A<br>
        continuaci&oacute;n, se refactoriza su c&oacute;digo ampli&aacute;ndolo 
        y mejor&aacute;ndolo para que se adapte mejor a<br>
        otras situaciones. En primer lugar, se definen unas variables que se utilizan 
        en la funci&oacute;n que<br>
        procesa la respuesta del servidor:<br>
        var READY_STATE_UNINITIALIZED = 0;<br>
        var READY_STATE_LOADING = 1;<br>
        var READY_STATE_LOADED = 2;<br>
        var READY_STATE_INTERACTIVE = 3;<br>
        var READY_STATE_COMPLETE = 4;<br>
        Como se ver&aacute; m&aacute;s adelante, la respuesta del servidor s&oacute;lo 
        puede corresponder a alguno de los<br>
        cinco estados definidos por las variables anteriores. De esta forma, el 
        c&oacute;digo puede utilizar el<br>
        nombre de cada estado en vez de su valor num&eacute;rico, por lo que se 
        facilita la lectura y el<br>
        mantenimiento de las aplicaciones.<br>
        Adem&aacute;s, la variable que almacena la instancia del objeto XMLHttpRequest 
        se va a transformar en<br>
        una variable global, de forma que todas las funciones que hacen uso de 
        ese objeto tengan acceso<br>
        directo al mismo:<br>
        var peticion_http;<br>
        A continuaci&oacute;n, se crea una funci&oacute;n gen&eacute;rica de carga 
        de contenidos mediante AJAX:<br>
        function cargaContenido(url, metodo, funcion) {<br>
        peticion_http = inicializa_xhr();<br>
        if(peticion_http) {<br>
        peticion_http.onreadystatechange = funcion;<br>
        peticion_http.open(metodo, url, true);<br>
        peticion_http.send(null);<br>
        }<br>
        }<br>
        La funci&oacute;n definida admite tres par&aacute;metros: la URL del contenido 
        que se va a cargar, el m&eacute;todo<br>
        utilizado para realizar la petici&oacute;n HTTP y una referencia a la 
        funci&oacute;n que procesa la respuesta<br>
        del servidor.<br>
        En primer lugar, la funci&oacute;n cargaContenido() inicializa el objeto 
        XMLHttpRequest (llamado xhr<br>
        de forma abreviada). Una vez inicializado, se emplea el objeto peticion_http 
        para establecer la<br>
        funci&oacute;n que procesa la respuesta del servidor. Por &uacute;ltimo, 
        la funci&oacute;n cargaContenido() realiza la<br>
        petici&oacute;n al servidor empleando la URL y el m&eacute;todo HTTP indicados 
        como par&aacute;metros.<br>
        La funci&oacute;n inicializa_xhr() se emplea para encapsular la creaci&oacute;n 
        del objeto XMLHttpRequest:<br>
        function inicializa_xhr() {<br>
        if(window.XMLHttpRequest) {<br>
        return new XMLHttpRequest();<br>
        }<br>
        else if(window.ActiveXObject) {<br>
        return new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);<br>
        }<br>
        }<br>
        La funci&oacute;n muestraContenido() tambi&eacute;n se refactoriza para 
        emplear las variables globales<br>
        definidas:<br>
        function muestraContenido() {<br>
        if(peticion_http.readyState == READY_STATE_COMPLETE) {<br>
        if(peticion_http.status == 200) {<br>
        alert(peticion_http.responseText);<br>
        }<br>
        }<br>
        }<br>
        Por &uacute;ltimo, la funci&oacute;n descargaArchivo() simplemente realiza 
        una llamada a la funci&oacute;n<br>
        cargaContenido() con los par&aacute;metros adecuados:<br>
        function descargaArchivo() {<br>
        cargaContenido(&quot;http://localhost/holamundo.txt&quot;, &quot;GET&quot;, 
        muestraContenido);<br>
        }<br>
        A continuaci&oacute;n se muestra el c&oacute;digo completo de la refactorizaci&oacute;n 
        de la primera aplicaci&oacute;n:<br>
        &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; 
        &quot;http://www.w3.org/TR/<br>
        xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;<br>
        &lt;html&gt;<br>
        &lt;head&gt;<br>
        &lt;title&gt;Hola Mundo con AJAX, version 2&lt;/title&gt;<br>
        &lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot;&gt;<br>
        var READY_STATE_UNINITIALIZED=0;<br>
        var READY_STATE_LOADING=1;<br>
        var READY_STATE_LOADED=2;<br>
        var READY_STATE_INTERACTIVE=3;<br>
        var READY_STATE_COMPLETE=4;<br>
        var peticion_http;<br>
        function cargaContenido(url, metodo, funcion) {<br>
        peticion_http = inicializa_xhr();<br>
        if(peticion_http) {<br>
        peticion_http.onreadystatechange = funcion;<br>
        peticion_http.open(metodo, url, true);<br>
        peticion_http.send(null);<br>
        }<br>
        }<br>
        function inicializa_xhr() {<br>
        if(window.XMLHttpRequest) {<br>
        return new XMLHttpRequest();<br>
        }<br>
        else if(window.ActiveXObject) {<br>
        return new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);<br>
        }<br>
        }<br>
        function muestraContenido() {<br>
        if(peticion_http.readyState == READY_STATE_COMPLETE) {<br>
        if(peticion_http.status == 200) {<br>
        alert(peticion_http.responseText);<br>
        }<br>
        }<br>
        }<br>
        function descargaArchivo() {<br>
        cargaContenido(&quot;http://localhost/holamundo.txt&quot;, &quot;GET&quot;, 
        muestraContenido);<br>
        }<br>
        window.onload = descargaArchivo;<br>
        &lt;/script&gt;<br>
        &lt;/head&gt;<br>
        &lt;body&gt;&lt;/body&gt;<br>
        &lt;/html&gt;</p>
      
      <p>
</p></td>
  </tr>
  <tr> 
    <td width="66" height="21"></td>
    <td width="324" height="21">&nbsp;</td>
    <td width="149"><div align="right"><a href="../index.htm" target="_parent">&lt;&lt;Men&uacute; 
        Inicio</a></div></td>
  </tr>
</table>
<p>&nbsp;</p>
</body>
</html>
